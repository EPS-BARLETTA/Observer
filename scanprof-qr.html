<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <title>EPS Observer — QR ScanProf</title>
  <style>
    html,body{
      margin:0;
      height:100%;
      background:#ffffff;
      color:#0f172a;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
    }
    .wrap{
      height:100%;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      gap:18px;
      padding:20px;
    }
    .qr{
      background:#fff;
      padding:20px;
      border-radius:16px;
      box-shadow:0 4px 30px rgba(15,23,42,0.12);
    }
    .bar{
      position:fixed;
      top:10px;
      left:10px;
      right:10px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
    }
    .btn{
      border:1px solid #e5e7eb;
      padding:10px 14px;
      border-radius:12px;
      background:#f3f4f6;
      font-weight:600;
      text-decoration:none;
      color:#0f172a;
    }
    .note{
      color:#4b5563;
      font-size:14px;
    }
  </style>
</head>
<body>
  <div class="bar">
    <a class="btn" href="javascript:history.back()">← Retour</a>
    <div class="note">Astuce : augmente la luminosité de l’écran pour faciliter le scan.</div>
  </div>
  <div class="wrap">
    <div id="qr" class="qr"></div>
    <div class="note" id="qrScope"></div>
    <div class="note" id="qrNote"></div>
  </div>

  <script src="./qrcode.min.js"></script>
  <script>
    (function(){
      const target = document.getElementById("qr");
      if (!target) return;
      try{
        const payload = sessionStorage.getItem("scanprof_last_qr_text");
        if(!payload){
          target.innerHTML = "<p>Aucune donnée QR disponible. Revenez sur le bilan et regénérez le QR.</p>";
          return;
        }
        const scope = sessionStorage.getItem("scanprof_last_qr_scope");
        const scopeEl = document.getElementById("qrScope");
        if (scopeEl) scopeEl.textContent = scope || "";
        const note = sessionStorage.getItem("scanprof_last_qr_note");
        const noteEl = document.getElementById("qrNote");
        if (noteEl) noteEl.textContent = note || "";
        new QRCode(target, {
          text: payload,
          width: Math.min(window.innerWidth, window.innerHeight) * 0.8,
          height: Math.min(window.innerWidth, window.innerHeight) * 0.8,
          colorDark: "#0f172a",
          colorLight: "#ffffff",
          correctLevel: QRCode.CorrectLevel.H
        });
      }catch(e){
        console.error(e);
        target.innerHTML = "<p>Erreur lors de l’affichage du QR.</p>";
      }
    })();
  </script>
</body>
</html>
